<div class="container mt-4">
  <h2>Gestion des Dépenses</h2>

  <!-- Boutons d'action -->
  <div class="mb-3">
    <button class="btn btn-primary me-2" (click)="addExpense()">Enregistrer une dépense</button>
    <button class="btn btn-secondary me-2" (click)="addCategory()">Créer une catégorie</button>
    <button class="btn btn-info" (click)="generateReport()">Générer un rapport</button>
  </div>

  <!-- Formulaire d'ajout/édition de dépense -->
  <div *ngIf="showExpenseForm" class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">{{ newExpense.id === 0 ? 'Nouvelle dépense' : 'Modifier la dépense' }}</h5>
      <form (ngSubmit)="saveExpense()">
        <div class="mb-3">
          <label for="amount" class="form-label">Montant</label>
          <input type="number" class="form-control" id="amount" [(ngModel)]="newExpense.amount" name="amount" required>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <input type="text" class="form-control" id="description" [(ngModel)]="newExpense.description" name="description" required>
        </div>
        <div class="mb-3">
          <label for="category" class="form-label">Catégorie</label>
          <select class="form-select" id="category" [(ngModel)]="newExpense.category" name="category" required>
            <option *ngFor="let cat of categories" [value]="cat.name">{{ cat.name }}</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="date" class="form-label">Date</label>
          <input type="date" class="form-control" id="date" [(ngModel)]="newExpense.date" name="date" required>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="isTontineExpense" [(ngModel)]="newExpense.isTontineExpense" name="isTontineExpense">
          <label class="form-check-label" for="isTontineExpense">Dépense liée à une tontine</label>
        </div>
        <div *ngIf="newExpense.isTontineExpense" class="mb-3">
          <label for="tontineName" class="form-label">Nom de la tontine</label>
          <input type="text" class="form-control" id="tontineName" [(ngModel)]="newExpense.tontineName" name="tontineName">
        </div>
        <button type="submit" class="btn btn-success">Enregistrer</button>
      </form>
    </div>
  </div>

  <!-- Formulaire d'ajout de catégorie -->
  <div *ngIf="showCategoryForm" class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">Nouvelle catégorie</h5>
      <form (ngSubmit)="saveCategory()">
        <div class="mb-3">
          <label for="categoryName" class="form-label">Nom de la catégorie</label>
          <input type="text" class="form-control" id="categoryName" [(ngModel)]="newCategory.name" name="categoryName" required>
        </div>
        <button type="submit" class="btn btn-success">Ajouter</button>
      </form>
    </div>
  </div>

  <!-- Liste des dépenses -->
  <h3>Historique des dépenses</h3>
  <table class="table">
    <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Catégorie</th>
      <th>Montant</th>
      <th>Tontine</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let expense of expenses">
      <td>{{ expense.date | date:'dd/MM/yyyy' }}</td>
      <td>{{ expense.description }}</td>
      <td>{{ expense.category }}</td>
      <td>{{ expense.amount | currency:'XAF':'symbol':'1.0-0' }}</td>
      <td>{{ expense.isTontineExpense ? (expense.tontineName || 'Oui') : 'Non' }}</td>
      <td>
        <button class="btn btn-sm btn-warning me-2" (click)="editExpense(expense)">Modifier</button>
        <button class="btn btn-sm btn-danger me-2" (click)="deleteExpense(expense.id)">Supprimer</button>
        <input type="file" (change)="uploadInvoice($event, expense.id)" accept=".pdf,.jpg,.png" class="d-none" #fileInput>
        <button class="btn btn-sm btn-secondary" (click)="fileInput.click()">Ajouter facture</button>
        <a *ngIf="expense.invoiceUrl" [href]="expense.invoiceUrl" target="_blank" class="btn btn-sm btn-link">Voir facture</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>
